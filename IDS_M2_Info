# IDS Milestone 2 – Curated Suricata Rules  
*(IDS-10 and IDS-11)*

Environment for this portion of the milestone:

- Sensor: **Security Onion 2.4.x** (single-node lab deployment)
- IDS engine: **Suricata (NIDS)**
- Attacker host: **Kali Linux VM** on the same lab network
- All attack traffic originates from Kali and targets the Security Onion sensor (or services fronted by it).

---

## IDS-10 – Identify Lab Attack Scenarios and Map Rules

For IDS-10, I defined three repeatable lab attack scenarios that exercise different parts of the Suricata ruleset: network reconnaissance, authentication abuse, and web-application attacks. For each scenario, I selected or created at least one Suricata rule and documented the mapping.

### Scenario Definitions and Rule Mapping

| Scenario | Description / Tool (from Kali) | Suricata Rule Title | SID (publicId) | Ruleset | Enabled? |
|---------|---------------------------------|---------------------|----------------|---------|---------|
| **A – Port scan** | TCP SYN scan against the Security Onion host using Nmap:<br>`sudo nmap -sS -T4 -p 1-100 SO_IP` | `LAB Possible TCP SYN Scan` | **9000001** | `__custom__` | `true` |
| **B – SSH brute/scan** | Repeated TCP connection attempts to SSH on port 22 using a simple `nc` loop:<br>`for i in $(seq 1 25); do nc -vz SO_IP 22; done` | `LAB Possible SSH Brute Force` | **9000002** | `__custom__` | `true` |
| **C – HTTP web attack** | Suspicious HTTP GET to `nmap.php` with a `target` parameter from Kali:<br>`curl "http://SO_IP/nmap.php?target=1.2.3.4"` | `ET WEB_SPECIFIC_APPS SnortReport nmap.php target Parameter Arbitrary Command Execution Attempt` | **2011555** | `ETOPEN` | `true` |

These three scenarios give a compact but meaningful lab set: recon (SYN scan), service abuse (SSH), and web-app exploitation (HTTP).

---

## IDS-11 – Enable/Disable or Adjust Suricata Rules to Create a Focused “Lab Rule Pack”

For IDS-11, I curated a focused lab rule pack using the **SOC → Detections → Suricata (NIDS)** interface. The goal was to:

1. Create targeted custom rules for the port-scan and SSH scenarios.
2. Ensure at least one appropriate HTTP attack rule was enabled.
3. Keep unrelated high-noise rules out of the way so alerts are easy to interpret.

```text
### Custom Rule 1 – LAB Possible TCP SYN Scan (Port Scan)
alert tcp any any -> $HOME_NET any (msg:"LAB Possible TCP SYN Scan"; flags:S; threshold:type both, track by_src, count 10, seconds 10; classtype:attempted-recon; sid:9000001; rev:1;)

### Custom Rule 2 – LAB Possible SSH Brute Force (SSH Scan/Brute)
alert tcp any any -> $HOME_NET 22 (msg:"LAB Possible SSH Brute Force"; flags:S; threshold:type both, track by_src, count 10, seconds 60; classtype:attempted-admin; sid:9000002; rev:1;)

### Custom Rule 3 – SnortReport HTTP Command Execution (HTTP Web Attack)
# Existing ET OPEN rule used as part of the lab pack
# Title: ET WEB_SPECIFIC_APPS SnortReport nmap.php target Parameter Arbitrary Command Execution Attempt
# SID: 2011555
# Ruleset: ETOPEN

---

## IDS-12 – Trigger Each Scenario and Confirm Alerts

For IDS-12, I executed each of the three lab scenarios from the Kali VM and verified that Suricata generated at least one alert for the corresponding rule.

### Scenario A – Port Scan (LAB Possible TCP SYN Scan)

- Command on Kali: `sudo nmap -sS -T4 -p 1-100 SO_IP`
- Expected mapping:
  - Rule: LAB Possible TCP SYN Scan
  - SID: 9000001
- Verification steps:
  - In SOC, open Alerts and set the time range to “Last 15 minutes”.
  - Filter by signature name `LAB Possible TCP SYN Scan` or by source IP `KALI_IP`.
  - Confirm at least one alert with:
    - Source IP = KALI_IP
    - Destination IP = SO_IP
    - Signature = LAB Possible TCP SYN Scan.
- Evidence: screenshot `m2_scenarioA_portscan_alert.png` showing the alert row with correct src/dst and signature.

---

### Scenario B – SSH Brute/Scan (LAB Possible SSH Brute Force)

- Command on Kali: `for i in $(seq 1 25); do nc -vz SO_IP 22; done`
- Expected mapping:
  - Rule: LAB Possible SSH Brute Force
  - SID: 9000002
- Verification steps:
  - In SOC → Alerts, time range “Last 15 minutes”.
  - Filter by signature name `LAB Possible SSH Brute Force` or by source IP `KALI_IP`.
  - Confirm at least one alert with:
    - Source IP = KALI_IP
    - Destination IP = SO_IP
    - Destination port = 22/tcp
    - Signature = LAB Possible SSH Brute Force.
- Evidence: screenshot `m2_scenarioB_ssh_alert.png` showing the SSH brute/scan alert.

---

### Scenario C – HTTP Web Attack (SnortReport nmap.php)

- Command on Kali: `curl "http://SO_IP/nmap.php?target=1.2.3.4"`
- Expected mapping:
  - Rule: ET WEB_SPECIFIC_APPS SnortReport nmap.php target Parameter Arbitrary Command Execution Attempt
  - SID: 2011555
- Verification steps:
  - In SOC → Alerts, time range “Last 15 minutes”.
  - Search for `nmap.php` or filter by the SnortReport rule title.
  - Confirm at least one alert with:
    - Source IP = KALI_IP
    - Destination IP = SO_IP
    - Protocol = http
    - Signature = ET WEB_SPECIFIC_APPS SnortReport nmap.php target Parameter Arbitrary Command Execution Attempt.
- Evidence: screenshot `m2_scenarioC_http_alert.png` showing the HTTP attack alert.

---

IDS-12 Result: all three lab scenarios produced the expected Suricata alerts, confirming that the curated lab rule pack is active and correctly detecting the Nmap scan, SSH brute/scan, and HTTP web-attack traffic generated from the Kali VM.
