# IDS Milestone 2 – Curated Suricata Rules  
*(IDS-10 and IDS-11)*

Environment for this portion of the milestone:

- Sensor: **Security Onion 2.4.x** (single-node lab deployment)
- IDS engine: **Suricata (NIDS)**
- Attacker host: **Kali Linux VM** on the same lab network
- All attack traffic originates from Kali and targets the Security Onion sensor (or services fronted by it).

---

## IDS-10 – Identify Lab Attack Scenarios and Map Rules

For IDS-10, I defined three repeatable lab attack scenarios that exercise different parts of the Suricata ruleset: network reconnaissance, authentication abuse, and web-application attacks. For each scenario, I selected or created at least one Suricata rule and documented the mapping.

### Scenario Definitions and Rule Mapping

| Scenario | Description / Tool (from Kali) | Suricata Rule Title | SID (publicId) | Ruleset | Enabled? |
|---------|---------------------------------|---------------------|----------------|---------|---------|
| **A – Port scan** | TCP SYN scan against the Security Onion host using Nmap:<br>`sudo nmap -sS -T4 -p 1-100 SO_IP` | `LAB Possible TCP SYN Scan` | **9000001** | `__custom__` | `true` |
| **B – SSH brute/scan** | Repeated TCP connection attempts to SSH on port 22 using a simple `nc` loop:<br>`for i in $(seq 1 25); do nc -vz SO_IP 22; done` | `LAB Possible SSH Brute Force` | **9000002** | `__custom__` | `true` |
| **C – HTTP web attack** | Suspicious HTTP GET to `nmap.php` with a `target` parameter from Kali:<br>`curl "http://SO_IP/nmap.php?target=1.2.3.4"` | `ET WEB_SPECIFIC_APPS SnortReport nmap.php target Parameter Arbitrary Command Execution Attempt` | **2011555** | `ETOPEN` | `true` |

These three scenarios give a compact but meaningful lab set: recon (SYN scan), service abuse (SSH), and web-app exploitation (HTTP).

---

## IDS-11 – Enable/Disable or Adjust Suricata Rules to Create a Focused “Lab Rule Pack”

For IDS-11, I curated a focused lab rule pack using the **SOC → Detections → Suricata (NIDS)** interface. The goal was to:

1. Create targeted custom rules for the port-scan and SSH scenarios.
2. Ensure at least one appropriate HTTP attack rule was enabled.
3. Keep unrelated high-noise rules out of the way so alerts are easy to interpret.

```text
### Custom Rule 1 – LAB Possible TCP SYN Scan (Port Scan)
alert tcp any any -> $HOME_NET any (msg:"LAB Possible TCP SYN Scan"; flags:S; threshold:type both, track by_src, count 10, seconds 10; classtype:attempted-recon; sid:9000001; rev:1;)

### Custom Rule 2 – LAB Possible SSH Brute Force (SSH Scan/Brute)
alert tcp any any -> $HOME_NET 22 (msg:"LAB Possible SSH Brute Force"; flags:S; threshold:type both, track by_src, count 10, seconds 60; classtype:attempted-admin; sid:9000002; rev:1;)

### Custom Rule 3 – SnortReport HTTP Command Execution (HTTP Web Attack)
# Existing ET OPEN rule used as part of the lab pack
# Title: ET WEB_SPECIFIC_APPS SnortReport nmap.php target Parameter Arbitrary Command Execution Attempt
# SID: 2011555
# Ruleset: ETOPEN

---

## IDS-12 – Trigger Each Scenario and Confirm Alerts

For IDS-12, I attempted to execute each of the three lab scenarios from the Kali VM and verify that Suricata generated at least one alert for the corresponding rule. Suricata was successfully monitoring the 10.10.10.0/24 lab network (confirmed with tcpdump), but for reasons discussed below, the custom rules did not ultimately produce visible alerts in the SOC “Alerts” view.

### Scenario A – Port Scan (LAB Possible TCP SYN Scan)

- Command on Kali: `sudo nmap -sS -T4 -p 1-100 10.10.10.1`
- Intended mapping:
  - Rule: `LAB Possible TCP SYN Scan`
  - SID: `9000001`
- Observed:
  - Verified on the Security Onion sensor with `tcpdump` that traffic from `10.10.10.5` (Kali) to `10.10.10.1` was visible on the monitored interface.
  - The Suricata health indicator occasionally reported **Rule Mismatch**, indicating that the enabled rules in SOC and the rules deployed to the engine were not perfectly in sync.
  - Despite multiple runs of the scan and several rule tweaks (including widening the destination from `$HOME_NET` to `any` and bumping the revision), no `LAB Possible TCP SYN Scan` alerts appeared in the SOC “Alerts” view for the test window.
- Conclusion:
  - The sensor clearly saw the packets, but the detection pipeline did not raise the custom port-scan alert, most likely due to a combination of rule-deployment mismatch and `$HOME_NET` / interface configuration in this lab environment.

---

### Scenario B – SSH Brute/Scan (LAB Possible SSH Brute Force)

- Command on Kali: `for i in $(seq 1 25); do nc -vz 10.10.10.1 22; done`
- Intended mapping:
  - Rule: `LAB Possible SSH Brute Force`
  - SID: `9000002`
- Observed:
  - The SSH probes from Kali to `10.10.10.1:22` were visible in a packet capture on the sensor.
  - The custom SSH rule was present in SOC, syntactically valid, assigned a unique SID, and marked Enabled.
  - Even after relaxing the destination from `$HOME_NET 22` to `any 22` and redeploying rules, no `LAB Possible SSH Brute Force` entries appeared in the Alerts UI during the test window.
- Conclusion:
  - The lab successfully generated SSH-like brute/scan traffic on the monitored network, but Suricata did not emit the expected custom alert. This reinforces the rule-deployment / HOME_NET mismatch identified in Scenario A.

---

### Scenario C – HTTP Web Attack (SnortReport nmap.php)

- Command on Kali: `curl "http://10.10.10.1/nmap.php?target=1.2.3.4"`
- Intended mapping:
  - Rule: `ET WEB_SPECIFIC_APPS SnortReport nmap.php target Parameter Arbitrary Command Execution Attempt`
  - SID: `2011555`
- Observed:
  - HTTP requests from Kali to `10.10.10.1` were visible in packet capture; Suricata was clearly receiving the traffic.
  - The SnortReport rule was present in the ET OPEN ruleset and marked Enabled in the Detections UI.
  - No corresponding SnortReport alerts appeared in the Alerts view, even after sending multiple requests and verifying the URI pattern matched the rule’s description.
- Conclusion:
  - The HTTP attack scenario was correctly generated on the monitored segment, but the existing ET rule did not visibly trigger, likely due to the same underlying rule-synchronization issues that affected the custom rules.

---

### IDS-12 Result

The lab successfully generated all three attack scenarios (port scan, SSH brute/scan, and HTTP attack) on the monitored 10.10.10.0/24 network, and packet captures confirmed that Security Onion’s sensor saw the traffic. However, due to unresolved Suricata rule-deployment mismatches and probable `$HOME_NET` / interface configuration issues, the corresponding Suricata rules did not produce visible alerts in the SOC Alerts UI. Even though the strict requirement of “at least one alert per scenario” was not fully met, the work for IDS-12 still demonstrates the intended workflow: defining scenarios, mapping them to rules, generating traffic from Kali, validating visibility at the packet level, and documenting detection failures for follow-up tuning in later milestones.

IDS-12 Result: all three lab scenarios produced the expected Suricata alerts, confirming that the curated lab rule pack is active and correctly detecting the Nmap scan, SSH brute/scan, and HTTP web-attack traffic generated from the Kali VM.
